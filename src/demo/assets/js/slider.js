(()=>{"use strict";const t={min:0,max:100,step:10,value:[0],isRange:!1,direction:"horizontal",hasFill:!0,hasTips:!0,hasScale:!0,isDecimal:!1,decimalPlaces:0},e=100,s=class{constructor(t={}){this.subscribers=t}subscribe(t,e){this.subscribers[t]=this.subscribers[t]||[],this.subscribers[t].push(e)}unsubscribe(t,e){this.subscribers[t]=this.subscribers[t].filter((t=>e!==t))}notify(e,s=t){this.subscribers[e].forEach((t=>{t(s)}))}getSubscribers(){return this.subscribers}},i=function(t){this.thumbs[t].style[this.view.offsetDirection]=`${this.getOffset()[t]}%`},a=function(t){const e=+!t,s=0===t,i=this.view.getValue()[0]>this.view.getValue()[1],a=this.view.getValue()[1]<this.view.getValue()[0];return i&&s||a&&!s?e:t},r=function(t){const e=this.thumbs[t],s=e=>{this.handleThumbDrag(e,t)},i=t=>{t.preventDefault(),t.stopPropagation(),document.addEventListener("pointermove",s)};e.addEventListener("pointerdown",i),e.addEventListener("touchstart",i),document.addEventListener("pointerup",(()=>{document.removeEventListener("pointermove",s)}))},l="slider__thumb";var h,n,c,u,d;!function(t){t.updateThumb="UpdateThumb",t.updateThumbAfterTrackClick="UpdateThumbAfterTrackClick",t.updateThumbView="UpdateThumbView",t.updateFillView="UpdateFillView",t.updateParams="UpdateParams",t.updatePanelValues="UpdatePanelValues",t.getSliderParams="GetSliderParams"}(h||(h={})),function(t){t.horizontal="horizontal",t.vertical="vertical"}(n||(n={})),function(t){t.min="min",t.max="max",t.step="step",t.value="value",t.isRange="isRange",t.direction="direction",t.hasFill="hasFill",t.hasTips="hasTips",t.hasScale="hasScale",t.isDecimal="isDecimal",t.decimalPlaces="decimalPlaces",t.datafirstValue="firstValue",t.dataSecondValue="secondValue"}(c||(c={})),function(t){t.left="left",t.top="top"}(u||(u={})),function(t){t.width="width",t.height="height"}(d||(d={}));const o=function(t,e){const{direction:s,isRange:i}=this.view.getParams(),{DOMroot:a}=this.view,r=this.view.getSize(),l=s===n.horizontal?t.pageX:t.pageY,c=this.view.calculateCursorOffset(l,s,a,r),u=i?this.validateCollision(e):e;this.setCursorOffset(c),this.setActiveStance(u),this.notify(h.updateThumb)},m=class extends s{constructor(t){super(),this.view=t,this.offset=[],this.activeStance=0,this.cursorOffset=0,this.thumbs=[],this.updateThumbStyle=i.bind(this),this.validateCollision=a.bind(this),this.dragAndDropThumb=r.bind(this),this.handleThumbDrag=o.bind(this)}setOffset(t,e){this.offset[t]=e}getOffset(){return this.offset}setCursorOffset(t){this.cursorOffset=t}getCursorOffset(){return this.cursorOffset}setActiveStance(t){this.activeStance=t}getActiveStance(){return this.activeStance}renderThumb(t){const e=document.createElement("div");e.classList.add(l),e.classList.add(`js-${l}-${t}`),e.classList.add(`${l}-${t}`),this.thumbs.push(e),this.view.DOMroot.appendChild(e),this.updateThumbStyle(t)}},f="slider__scale-mark",p=[3,5,7,11];function b(t,e){for(const s of e)if(t%s==0)return s;return b(t-1,e)}const w=function(t,s,i,a){const r=Math.round((s-t)/i+1),l=r-1,h=b(l,p);let c=Math.max(Math.floor(l/h),1);c=c<15?Math.min(c,h):c;const u=Math.abs(s-t),d=Math.ceil(r/c),o=d-1,m=Math.floor(u/i)>d?Math.round(Math.round(u/i)/o)*i:i;return{values:new Array(d).fill(null).map(((e,i)=>{let a=t+m*i;return a=Math.min(a,s),i===o&&(a=s),Number(a.toFixed(1))})),offsets:new Array(d).fill(null).map(((t,s)=>{let i=Math.abs(m/u)*s*e;return i=Math.min(e,i),s===o&&(i=e),a===n.vertical&&(i=Math.abs(e-i)),Number(i.toFixed(1))}))}},v=function(t,e,s,i){const a=w(s,e,t,i);for(let t=0;t<a.values.length;t+=1){const e=document.createElement("div");e.classList.add(f),e.classList.add(`${f}_${i}`),e.classList.add(`js-${f}_${i}`);const s=a.offsets[t];e.style[this.view.offsetDirection]=`${s}%`;const r=document.createElement("div");r.classList.add("slider__scale-number"),r.classList.add(`slider__scale-number_${i}`),r.classList.add(`js-slider__scale-number_${i}`),r.innerHTML=a.values[t].toString(),e.appendChild(r),this.scale.appendChild(e)}},S=function(){this.view.getParams().isRange?(this.fill.style[this.view.offsetDirection]=`${this.getState().fillOffset}%`,this.fill.style[this.view.fillDirection]=`${this.getState().fillSize}%`):this.fill.style[this.view.fillDirection]=`${this.getState().fillSize}%`},g=class extends s{constructor(t){super(),this.fill=document.querySelector(".slider__fill"),this.view=t,this.state={fillOffset:0,fillSize:0},this.updateFillStyle=S.bind(this)}setState({fillOffset:t,fillSize:e}){this.state.fillOffset=t,this.state.fillSize=e}getState(){return this.state}renderFill(t){const e=document.createElement("div");e.classList.add("slider__fill"),e.classList.add("js-slider__fill"),e.classList.add(`slider__fill_${t}`),this.fill=e,this.view.DOMroot.appendChild(e),this.updateFillStyle()}},T=function(){this.view.DOMroot.addEventListener("pointerdown",(t=>this.handleTrackClick(t)))},O=function(t){const{direction:e}=this.view.getParams(),{DOMroot:s}=this.view,i=this.view.getSize(),a=e===n.horizontal?t.pageX:t.pageY,r=this.view.calculateCursorOffset(a,e,s,i);this.setCursorOffset(r),this.notify(h.updateThumbAfterTrackClick)},V=class extends s{constructor(t){super(),this.view=t,this.cursorOffset=0,this.track=document.querySelector(".slider__track"),this.clickTrack=T.bind(this),this.handleTrackClick=O.bind(this)}setCursorOffset(t){this.cursorOffset=t}getCursorOffset(){return this.cursorOffset}renderTrack(t){const e=document.createElement("div");e.classList.add("slider__track"),e.classList.add("js-slider__track"),e.classList.add(`slider__track_${t}`),this.track=e,this.view.DOMroot.appendChild(e)}},P=function(t){this.tips[t].style[this.view.offsetDirection]=`${this.getOffset()[t]}%`,this.tips[t].innerHTML=this.view.getValue()[t].toFixed(this.view.getParams().decimalPlaces)},M=class extends s{constructor(t){super(),this.view=t,this.offset=[],this.tips=[],this.updateTipStyle=P.bind(this)}setOffset(t,e){this.offset[t]=e}getOffset(){return this.offset}renderTip(t,e){const s=document.createElement("div");s.classList.add("slider__tip"),s.classList.add(`js-slider__tip-${t}`),s.classList.add(`slider__tip-${t}`),s.classList.add(`slider__tip_${e}`),this.tips.push(s),this.view.DOMroot.appendChild(s),this.updateTipStyle(t)}},D=function(t){this.offsetDirection=t===n.horizontal?u.left:u.top,this.fillDirection=t===n.horizontal?d.width:d.height},F=function(t,s,i,a){return s===n.horizontal?(t-i.offsetLeft)/a*e:(t-i.offsetTop)/a*e},_=class extends s{constructor(e){super(),this.DOMroot=e,this.thumbView=new m(this),this.trackView=new V(this),this.scaleView=new class{constructor(t){this.view=t,this.scale=document.querySelector(".slider__scale"),this.renderScaleMarks=v.bind(this)}renderScale(t){const e=document.createElement("div");e.classList.add("slider__scale"),e.classList.add("js-slider__scale"),e.classList.add(`slider__scale_${t}`),this.scale=e,this.view.DOMroot.appendChild(e)}}(this),this.fillView=new g(this),this.tipView=new M(this),this.params=t,this.size=0,this.offsetDirection=u.left,this.fillDirection=d.width,this.prepareDirectionForInteraction=D.bind(this),this.calculateCursorOffset=F.bind(this)}setParams(t){this.params=t}setParam(t,e){this.params[t]=e}setSize(t){this.size=t}getParams(){return this.params}getSize(){return this.size}setValue(t,e){this.params.value[t]=e}getValue(){return this.params.value}},L=function(t){const{direction:e}=this.getParams();return e===n.horizontal?t:100-t},k=function(t){const{min:e,max:s,direction:i}=this.getParams();this.getOffset()[t]>100&&(this.setOffset(t,100),this.setValue(t,i===n.horizontal?s:e)),this.getOffset()[t]<0&&(this.setOffset(t,0),this.setValue(t,i===n.horizontal?e:s))},z=function({min:t,max:e,value:s,decimalPlaces:i,step:a,isRange:r,direction:l,hasFill:h,hasTips:n,hasScale:c,isDecimal:u,panel:d}){const o=s,m=function(t,e,s){let i=Math.min(Math.abs(e-s),Math.abs(t));return 0===i&&(i=1),i}(a,t,e),f=function(t,e,s){return Math.min(e-s,t)}(t,e,m),p=function(t,e,s){const i=Math.min(t,e);return s?i:0}(i,3,u);return o[0]=function(t,e,s){const i=t;return i[0]=Math.max(e,i[0]),i[0]=Math.min(s,i[0]),i[0]}(o,t,e),r&&(1===o.length&&o.push(o[0]),o[1]=function(t,e,s){const i=t;return i[1]=Math.max(e,t[1]),i[1]=Math.min(s,t[1]),i[1]=Math.max(i[0],i[1]),i[1]}(o,t,e)),{min:f,max:e,step:m,value:o,decimalPlaces:p,isDecimal:u,isRange:r,direction:l,hasFill:h,hasTips:n,hasScale:c,panel:d}},C=class extends s{constructor(e){super(),this.DOMroot=e,this.params=t,this.thumbsOffset=[],this.fillState={fillOffset:0,fillSize:0},this.size=0,this.activeStance=0,this.endsValidation=k.bind(this),this.prepareOffset=L.bind(this),this.validateParams=z.bind(this)}setParams(t){this.params=this.validateParams(t)}setParam(t,e){this.params[t]=e}getParams(){return this.params}setSize(t){this.size=t}getSize(){return this.size}setValue(t,e){const{decimalPlaces:s}=this.params;this.params.value[t]=Number(e.toFixed(s))}getValue(){const{value:t}=this.params;return t}setOffset(t,e){this.thumbsOffset[t]=e}getOffset(){return this.thumbsOffset}setActiveStance(t){this.activeStance=t}getActiveStance(){return this.activeStance}calculateOffset(t){const{min:s,max:i,value:a}=this.params;return this.prepareOffset((a[t]-s)/((i-s)/e))}updateThumb(t,e){const s=this.prepareOffset(e),i=this.calculateStepPercent(),a=Math.round(s/i)*i;this.setValue(t,this.calculateValue(a,i)),this.setOffset(t,this.calculateOffset(t)),this.endsValidation(t),this.setActiveStance(t),this.notify(h.updateThumbView),this.params.hasFill&&this.updateFill(),this.notify(h.getSliderParams,this.getParams())}updateThumbAfterTrackClick(t){const{fillOffset:e,fillSize:s}=this.getFillState();let i=0;t>s/2+e&&(i=1),i=this.chooseCorrectStance(i),this.updateThumb(i,t)}updateFill(){this.setFillState(this.calculateFillState()),this.notify(h.updateFillView)}setFillState(t){this.fillState=t}getFillState(){return this.fillState}calculateFillState(){return{fillOffset:this.calculateFillOffset(),fillSize:this.calculateFillSize()}}chooseCorrectStance(t){const{isRange:e,direction:s}=this.getParams();return s===n.vertical?Number(!t):e?t:0}calculateFillSize(){const{isRange:t}=this.params;return t?this.calculateBasedOnDirection(this.thumbsOffset[0],this.thumbsOffset[1]):this.prepareOffset(this.thumbsOffset[0])}calculateBasedOnDirection(t,e){const{direction:s}=this.getParams();return s===n.horizontal?e-t:t-e}calculateFillOffset(){const{isRange:t,direction:e}=this.params;return t?e===n.horizontal?this.thumbsOffset[0]:this.thumbsOffset[1]:0}calculateStepPercent(){const{max:t,min:s,step:i}=this.params;return e/((t-s)/i)}calculateValue(t,e){const{step:s,min:i}=this.params;return t/e*s+i}},x=function(){const{direction:t}=this.model.getParams(),e=t===n.horizontal?n.vertical:n.horizontal;this.DOMroot.classList.remove(`slider_${e}`),this.DOMparent.classList.remove(`slider-parent_${e}`),this.DOMroot.innerHTML=""},y=function(){$(this.DOMroot.classList[0]).off()},A=function(){return this.view.thumbView.subscribe(h.updateThumb,this.updateThumb),this.view.trackView.subscribe(h.updateThumbAfterTrackClick,this.updateThumbAfterTrackClick),this.model.subscribe(h.getSliderParams,this.getSliderParams),this.model.subscribe(h.updateThumbView,this.updateThumbView),this.model.getParams().hasFill&&this.model.subscribe(h.updateFillView,this.updateFillView),this.model.getParams().hasTips&&this.model.subscribe(h.updateThumbView,this.updateTipView),this},R=function(){const t=this.model.getActiveStance(),e=this.model.getOffset()[t];this.view.tipView.setOffset(t,e),this.view.tipView.updateTipStyle(t)},E=function(){const t=this.model.getFillState();this.view.fillView.setState(t),this.view.fillView.updateFillStyle()},N=function(){const{isRange:t}=this.model.getParams();return this.view.thumbView.dragAndDropThumb(0),this.view.trackView.clickTrack(),t&&this.view.thumbView.dragAndDropThumb(1),this},j=function(){const t=this.view.trackView.getCursorOffset();this.model.updateThumbAfterTrackClick(t)},B=function(){const t=this.view.thumbView.getActiveStance(),e=this.view.thumbView.getCursorOffset();this.model.updateThumb(t,e)},H=function(){const t=this.model.getActiveStance(),e=this.model.getOffset()[t];this.view.thumbView.setOffset(t,e),this.view.thumbView.updateThumbStyle(t),this.view.thumbView.setActiveStance(t)},U=function(){return this.view.thumbView.unsubscribe(h.updateThumb,this.updateThumb),this.view.trackView.unsubscribe(h.updateThumbAfterTrackClick,this.updateThumbAfterTrackClick),this.model.unsubscribe(h.getSliderParams,this.getSliderParams),this.model.unsubscribe(h.updateThumbView,this.updateThumbView),this.getParams().hasFill||this.model.unsubscribe(h.updateFillView,this.updateFillView),this.getParams().hasTips||this.model.unsubscribe(h.updateThumbView,this.updateTipView),this},q=function(t){return t};function I({min:e,max:s,value:i,decimalPlaces:a,step:r,isRange:l,direction:h,hasFill:n,hasTips:c,hasScale:u,isDecimal:d,panel:o}){const m=null!=e?e:t.min,f=null!=s?s:t.max,p=null!=a?a:t.decimalPlaces,b=null!=r?r:t.step,w=null!=l?l:t.isRange,v=null!=h?h:t.direction,S=null!=n?n:t.hasFill,g=null!=c?c:t.hasTips,T=null!=u?u:t.hasScale,O=null!=d?d:t.isDecimal,V=null!=o?o:t.panel;let P=null!=i?i:t.value;return Array.isArray(P)||(P=[P]),l&&1===P.length&&P.push(P[0]),{min:m,max:f,value:P,decimalPlaces:p,step:b,isRange:w,direction:v,hasFill:S,hasTips:g,hasScale:T,isDecimal:O,panel:V}}$.fn.extend({slider:function(t){const e=this[0],s=I(t||{}),i=function(t,e){let s;return s=t.data(c.datafirstValue)&&t.data(c.dataSecondValue)?[Number(t.data(c.datafirstValue)),Number(t.data(c.dataSecondValue))]:Number(t.data(c.datafirstValue))||Number(t.data(c.dataSecondValue))?[Number(t.data(c.datafirstValue))]||0:e.value,{min:Number(t.data(c.min))||e.min,max:Number(t.data(c.max))||e.max,value:s,decimalPlaces:Number(t.data(c.decimalPlaces))||e.decimalPlaces,step:Number(t.data(c.step))||e.step,isRange:Boolean(t.data(c.isRange))||e.isRange,direction:t.data(c.direction)||e.direction,hasFill:Boolean(t.data(c.hasFill))||e.hasFill,hasTips:Boolean(t.data(c.hasTips))||e.hasTips,hasScale:Boolean(t.data(c.hasScale))||e.hasScale,isDecimal:Boolean(t.data(c.isDecimal))||e.isDecimal}}($(e),s);return new class{constructor(t,e){this.params=e,this.DOMroot=t,this.DOMparent=t.parentElement,this.presenter=new class{constructor(t,e,s){this.DOMroot=e,this.DOMparent=s,this.model=new C(this.DOMroot),this.view=new _(this.DOMroot),this.params=t,this.clearHTML=x.bind(this),this.removeListeners=y.bind(this),this.subscribe=A.bind(this),this.unsubscribe=U.bind(this),this.updateThumbAfterTrackClick=j.bind(this),this.updateThumb=B.bind(this),this.updateThumbView=H.bind(this),this.updateTipView=R.bind(this),this.updateFillView=E.bind(this),this.addListeners=N.bind(this),this.getSliderParams=q.bind(this)}init(){this.setParams(this.params),this.createSlider(),this.subscribe(),this.addListeners()}rerender(t){this.setParams(t),this.view.thumbView.thumbs=[],this.view.tipView.tips=[],this.unsubscribe(),this.clearHTML(),this.removeListeners(),this.createSlider(),this.subscribe(),this.addListeners()}setParams(t){this.params=t}getParams(){return this.params}createSlider(){this.addSliderClasses(this.params.direction).setModelState().setViewState().setSubViewsState().renderSlider()}setModelState(){this.model.setParams(this.params);const t=this.model.getParams().direction===n.horizontal?this.DOMroot.offsetWidth:this.DOMroot.offsetHeight;return this.model.setSize(t),this.model.getParams().value.forEach(((t,e)=>{this.model.setOffset(e,this.model.calculateOffset(e))})),this.model.setFillState(this.model.calculateFillState()),this}addSliderClasses(t){return this.DOMroot.classList.add("slider"),this.DOMroot.classList.add("js-slider"),this.DOMroot.classList.add(`slider_${t}`),this.DOMroot.classList.add(`js-slider_${t}`),this.DOMparent.classList.add(`slider-parent_${t}`),this}setViewState(){return this.view.setParams(this.model.getParams()),this.view.setSize(this.model.getSize()),this.view.prepareDirectionForInteraction(this.model.getParams().direction),this}setSubViewsState(){const{hasTips:t,hasFill:e}=this.model.getParams(),s=this.model.getValue(),i=this.model.getFillState();return s.forEach(((e,s)=>{this.setThumbViewState(s),t&&this.setTipViewState(s)})),e&&this.setFillViewState(i),this}setThumbViewState(t){const e=this.model.getOffset()[t];this.view.thumbView.setOffset(t,e)}setFillViewState(t){this.view.fillView.setState(t)}setTipViewState(t){const e=this.model.getOffset()[t];this.view.tipView.setOffset(t,e)}renderSlider(){const{direction:t,hasFill:e,hasScale:s,hasTips:i,isRange:a}=this.model.getParams();this.renderTrack(t),this.renderThumb(0),i&&this.renderTip(0,t),s&&this.renderScale(t),e&&this.renderFill(t),a&&(this.renderThumb(1),i&&this.renderTip(1,t))}renderTrack(t){this.view.trackView.renderTrack(t)}renderThumb(t){this.view.thumbView.renderThumb(t)}renderTip(t,e){this.view.tipView.renderTip(t,e)}renderFill(t){this.view.fillView.renderFill(t)}renderScale(t){const{step:e,max:s,min:i}=this.model.getParams();this.view.scaleView.renderScale(t),this.view.scaleView.renderScaleMarks(e,s,i,t)}}(this.params,this.DOMroot,this.DOMparent),this.init()}getParams(){return this.params}getContainer(){return this.DOMroot}getParent(){return this.DOMparent}unsubscribe(){this.presenter.unsubscribe()}updateParams(t){this.presenter.rerender(I(t)),this.params=this.presenter.model.getParams()}subscribe(t){this.presenter.model.subscribe(h.getSliderParams,t)}init(){this.presenter.init(),this.attachResizeListener()}attachResizeListener(){window.addEventListener("resize",(()=>this.presenter.rerender(this.params)))}}(e,i)}}),document.querySelectorAll('[data-slider="true"]').forEach((t=>{$(t).slider()}))})();