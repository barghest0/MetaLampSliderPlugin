(()=>{"use strict";const t=class{constructor(t={}){this.subscribers=t}subscribe(t,e){this.subscribers[t]=this.subscribers[t]||[],this.subscribers[t].push(e)}unsubscribe(t,e){this.subscribers[t]=this.subscribers[t].filter((t=>e!==t))}notify(t,...e){this.subscribers[t].forEach((t=>{t(...e)}))}getSubscribers(){return this.subscribers}},e=function(t){this.thumbs[t].style[this.view.offsetDirection]=`${this.getOffset()[t]}%`},i={min:0,max:100,step:10,value:[0],isRange:!1,direction:"horizontal",hasFill:!0,hasTips:!0,hasScale:!0,isDecimal:!1,decimalPlaces:0},s=100,a=function(t){const e=+!t,i=0===t,s=this.view.getValue()[0]>this.view.getValue()[1],a=this.view.getValue()[1]<this.view.getValue()[0];return s&&i||a&&!i?e:t},l=function(t){const e=this.thumbs[t],i=e=>{this.handleThumbDrag(e,t)},s=t=>{t.preventDefault(),t.stopPropagation(),document.addEventListener("pointermove",i)};e.addEventListener("pointerdown",s),e.addEventListener("touchstart",s),document.addEventListener("pointerup",(()=>{document.removeEventListener("pointermove",i)}))},r="slider__thumb";var h,n,c,d,u;!function(t){t.updateThumb="UpdateThumb",t.updateThumbAfterTrackClick="UpdateThumbAfterTrackClick",t.updateFill="UpdateFill",t.updateThumbView="UpdateThumbView",t.updateFillView="UpdateFillView",t.updateParams="UpdateParams",t.updatePanelValues="UpdatePanelValues"}(h||(h={})),function(t){t.horizontal="horizontal",t.vertical="vertical"}(n||(n={})),function(t){t.min="min",t.max="max",t.step="step",t.value="value",t.isRange="isRange",t.direction="direction",t.hasFill="hasFill",t.hasTips="hasTips",t.hasScale="hasScale",t.isDecimal="isDecimal",t.decimalPlaces="decimalPlaces",t.datafirstValue="firstValue",t.dataSecondValue="secondValue"}(c||(c={})),function(t){t.left="left",t.top="top"}(d||(d={})),function(t){t.width="width",t.height="height"}(u||(u={}));const o=function(t,e){const{direction:i,isRange:s,hasFill:a}=this.view.getParams(),{DOMroot:l}=this.view,r=this.view.getSize(),c=i===n.horizontal?t.pageX:t.pageY,d=this.view.calculateCursorOffset(c,i,l,r),u=s?this.validateCollision(e):e;this.notify(h.updateThumb,u,d),a&&this.notify(h.updateFill)},m=class extends t{constructor(t){super(),this.view=t,this.offset=[],this.activeStance=0,this.thumbs=[],this.updateThumbStyle=e.bind(this),this.validateCollision=a.bind(this),this.dragAndDropThumb=l.bind(this),this.handleThumbDrag=o.bind(this)}setOffset(t,e){this.offset[t]=e}getOffset(){return this.offset}renderThumb(t){const e=document.createElement("div");e.classList.add(r),e.classList.add(`js-${r}-${t}`),e.classList.add(`${r}-${t}`),this.thumbs.push(e),this.view.DOMroot.appendChild(e),this.updateThumbStyle(t)}},f="slider__scale-mark",p=[3,5,7,11];function b(t,e){for(const i of e)if(t%i==0)return i;return b(t-1,e)}const w=function(t,e,i,a){const l=Math.round((e-t)/i+1),r=l-1,h=b(r,p);let c=Math.max(Math.floor(r/h),1);c=c<15?Math.min(c,h):c;const d=Math.abs(e-t),u=Math.ceil(l/c),o=u-1,m=Math.floor(d/i)>u?Math.round(Math.round(d/i)/o)*i:i;return{values:new Array(u).fill(null).map(((i,s)=>{let a=t+m*s;return a=Math.min(a,e),s===o&&(a=e),Number(a.toFixed(1))})),offsets:new Array(u).fill(null).map(((t,e)=>{let i=Math.abs(m/d)*e*s;return i=Math.min(s,i),e===o&&(i=s),a===n.vertical&&(i=Math.abs(s-i)),Number(i.toFixed(1))}))}},v=function(t,e,i,s){const a=w(i,e,t,s);for(let t=0;t<a.values.length;t+=1){const e=document.createElement("div");e.classList.add(f),e.classList.add(`${f}_${s}`),e.classList.add(`js-${f}_${s}`);const i=a.offsets[t];e.style[this.view.offsetDirection]=`${i}%`;const l=document.createElement("div");l.classList.add("slider__scale-number"),l.classList.add(`slider__scale-number_${s}`),l.classList.add(`js-slider__scale-number_${s}`),l.innerHTML=a.values[t].toString(),e.appendChild(l),this.scale.appendChild(e)}},S=function(){this.view.getParams().isRange?(this.fill.style[this.view.offsetDirection]=`${this.getState().fillOffset}%`,this.fill.style[this.view.fillDirection]=`${this.getState().fillSize}%`):this.fill.style[this.view.fillDirection]=`${this.getState().fillSize}%`},T=class extends t{constructor(t){super(),this.fill=document.querySelector(".slider__fill"),this.view=t,this.state={fillOffset:0,fillSize:0},this.updateFillStyle=S.bind(this)}setState({fillOffset:t,fillSize:e}){this.state.fillOffset=t,this.state.fillSize=e}getState(){return this.state}renderFill(t){const e=document.createElement("div");e.classList.add("slider__fill"),e.classList.add("js-slider__fill"),e.classList.add(`slider__fill_${t}`),this.fill=e,this.view.DOMroot.appendChild(e),this.updateFillStyle()}},g=function(){this.view.DOMroot.addEventListener("pointerdown",(t=>this.handleTrackClick(t)))},V=function(t){const{direction:e,hasFill:i}=this.view.getParams(),{DOMroot:s}=this.view,a=this.view.getSize(),l=e===n.horizontal?t.pageX:t.pageY,r=this.view.calculateCursorOffset(l,e,s,a);this.notify(h.updateThumbAfterTrackClick,r),i&&this.notify(h.updateFill)},O=class extends t{constructor(t){super(),this.view=t,this.track=document.querySelector(".slider__track"),this.clickTrack=g.bind(this),this.handleTrackClick=V.bind(this)}renderTrack(t){const e=document.createElement("div");e.classList.add("slider__track"),e.classList.add("js-slider__track"),e.classList.add(`slider__track_${t}`),this.track=e,this.view.DOMroot.appendChild(e)}},F=function(t){this.tips[t].style[this.view.offsetDirection]=`${this.getOffset()[t]}%`,this.tips[t].innerHTML=this.view.getValue()[t].toFixed(this.view.getParams().decimalPlaces)},M=class extends t{constructor(t){super(),this.view=t,this.offset=[],this.tips=[],this.updateTipStyle=F.bind(this)}setOffset(t,e){this.offset[t]=e}getOffset(){return this.offset}renderTip(t,e){const i=document.createElement("div");i.classList.add("slider__tip"),i.classList.add(`js-slider__tip-${t}`),i.classList.add(`slider__tip-${t}`),i.classList.add(`slider__tip_${e}`),this.tips.push(i),this.view.DOMroot.appendChild(i),this.updateTipStyle(t)}},D=function(t){this.offsetDirection=t===n.horizontal?d.left:d.top,this.fillDirection=t===n.horizontal?u.width:u.height},P=function(t,e,i,a){return e===n.horizontal?(t-i.offsetLeft)/a*s:(t-i.offsetTop)/a*s},_=class extends t{constructor(t){super(),this.DOMroot=t,this.thumbView=new m(this),this.trackView=new O(this),this.scaleView=new class{constructor(t){this.view=t,this.scale=document.querySelector(".slider__scale"),this.renderScaleMarks=v.bind(this)}renderScale(t){const e=document.createElement("div");e.classList.add("slider__scale"),e.classList.add("js-slider__scale"),e.classList.add(`slider__scale_${t}`),this.scale=e,this.view.DOMroot.appendChild(e)}}(this),this.fillView=new T(this),this.tipView=new M(this),this.params=i,this.size=0,this.offsetDirection=d.left,this.fillDirection=u.width,this.prepareDirectionForInteraction=D.bind(this),this.calculateCursorOffset=P.bind(this)}setParams(t){this.params=t}setParam(t,e){this.params[t]=e}setSize(t){this.size=t}getParams(){return this.params}getSize(){return this.size}setValue(t,e){this.params.value[t]=e}getValue(){return this.params.value}},L=function(t){const{direction:e}=this.getParams();return e===n.horizontal?t:100-t},k=function(t){const{min:e,max:i,direction:s}=this.getParams();this.getOffset()[t]>100&&(this.setOffset(t,100),this.setValue(t,s===n.horizontal?i:e)),this.getOffset()[t]<0&&(this.setOffset(t,0),this.setValue(t,s===n.horizontal?e:i))},z=function({min:t,max:e,value:i,decimalPlaces:s,step:a,isRange:l,direction:r,hasFill:h,hasTips:n,hasScale:c,isDecimal:d,panel:u}){const o=i,m=function(t,e,i){let s=Math.min(Math.abs(e-i),Math.abs(t));return 0===s&&(s=1),s}(a,t,e),f=function(t,e,i){return Math.min(e-i,t)}(t,e,m),p=function(t,e,i){const s=Math.min(t,e);return i?s:0}(s,3,d);return o[0]=function(t,e,i){const s=t;return s[0]=Math.max(e,s[0]),s[0]=Math.min(i,s[0]),s[0]}(o,t,e),l&&(1===o.length&&o.push(o[0]),o[1]=function(t,e,i){const s=t;return s[1]=Math.max(e,t[1]),s[1]=Math.min(i,t[1]),s[1]=Math.max(s[0],s[1]),s[1]}(o,t,e)),{min:f,max:e,step:m,value:o,decimalPlaces:p,isDecimal:d,isRange:l,direction:r,hasFill:h,hasTips:n,hasScale:c,panel:u}},x=class extends t{constructor(t){super(),this.DOMroot=t,this.params=i,this.thumbsOffset=[],this.fillState={fillOffset:0,fillSize:0},this.size=0,this.endsValidation=k.bind(this),this.prepareOffset=L.bind(this),this.validateParams=z.bind(this)}setParams(t){this.params=this.validateParams(t)}setParam(t,e){this.params[t]=e}getParams(){return this.params}setSize(t){this.size=t}getSize(){return this.size}setValue(t,e){const{decimalPlaces:i}=this.params;this.params.value[t]=Number(e.toFixed(i))}getValue(){const{value:t}=this.params;return t}setOffset(t,e){this.thumbsOffset[t]=e}getOffset(){return this.thumbsOffset}calculateOffset(t){const{min:e,max:i,value:a}=this.params;return this.prepareOffset((a[t]-e)/((i-e)/s))}updateThumb(t,e){const i=this.prepareOffset(e),s=this.calculateStepPercent(),a=Math.round(i/s)*s;this.setValue(t,this.calculateValue(a,s)),this.setOffset(t,this.calculateOffset(t)),this.endsValidation(t),this.notify(h.updateThumbView,t,this.getParams())}updateThumbAfterTrackClick(t){const{fillOffset:e,fillSize:i}=this.getFillState();let s=0;t>i/2+e&&(s=1),s=this.chooseCorrectStance(s),this.updateThumb(s,t)}updateFill(){this.setFillState(this.calculateFillState()),this.notify(h.updateFillView)}setFillState(t){this.fillState=t}getFillState(){return this.fillState}calculateFillState(){return{fillOffset:this.calculateFillOffset(),fillSize:this.calculateFillSize()}}chooseCorrectStance(t){const{isRange:e,direction:i}=this.getParams();return i===n.vertical?Number(!t):e?t:0}calculateFillSize(){const{isRange:t}=this.params;return t?this.calculateBasedOnDirection(this.thumbsOffset[0],this.thumbsOffset[1]):this.prepareOffset(this.thumbsOffset[0])}calculateBasedOnDirection(t,e){const{direction:i}=this.getParams();return i===n.horizontal?e-t:t-e}calculateFillOffset(){const{isRange:t,direction:e}=this.params;return t?e===n.horizontal?this.thumbsOffset[0]:this.thumbsOffset[1]:0}calculateStepPercent(){const{max:t,min:e,step:i}=this.params;return s/((t-e)/i)}calculateValue(t,e){const{step:i,min:s}=this.params;return t/e*i+s}},y=function(){const{direction:t}=this.model.getParams(),e=t===n.horizontal?n.vertical:n.horizontal;this.DOMroot.classList.remove(`slider_${e}`),this.DOMparent.classList.remove(`slider-parent_${e}`),this.DOMroot.innerHTML=""},C=function(){$(this.DOMroot.classList[0]).off()},R=function(){return this.view.thumbView.subscribe(h.updateThumb,this.updateThumb),this.view.trackView.subscribe(h.updateThumbAfterTrackClick,this.updateThumbAfterTrackClick),this.model.subscribe(h.updateThumbView,this.updateThumbView),this.model.getParams().hasFill&&(this.model.subscribe(h.updateFillView,this.updateFillView),this.view.thumbView.subscribe(h.updateFill,this.updateFill),this.view.trackView.subscribe(h.updateFill,this.updateFill)),this.model.getParams().hasTips&&this.model.subscribe(h.updateThumbView,this.updateTipView),this},E=function(t){const e=this.model.getOffset()[t];this.view.tipView.setOffset(t,e),this.view.tipView.updateTipStyle(t)},A=function(){const t=this.model.getFillState();this.view.fillView.setState(t),this.view.fillView.updateFillStyle()},N=function(){const{isRange:t}=this.model.getParams();return this.view.thumbView.dragAndDropThumb(0),this.view.trackView.clickTrack(),t&&this.view.thumbView.dragAndDropThumb(1),this},j=function(t){this.model.updateThumbAfterTrackClick(t)},B=function(t,e){this.model.updateThumb(t,e)},U=function(){this.model.updateFill()},H=function(t){const e=this.model.getOffset()[t];this.view.thumbView.setOffset(t,e),this.view.thumbView.updateThumbStyle(t),this.view.thumbView.activeStance=t},q=function(){return this.view.thumbView.unsubscribe(h.updateThumb,this.updateThumb),this.view.trackView.unsubscribe(h.updateThumbAfterTrackClick,this.updateThumbAfterTrackClick),this.model.unsubscribe(h.updateThumbView,this.updateThumbView),this.getParams().hasFill||(this.model.unsubscribe(h.updateFillView,this.updateFillView),this.view.thumbView.unsubscribe(h.updateFill,this.updateFill),this.view.trackView.unsubscribe(h.updateFill,this.updateFill)),this.getParams().hasTips||this.model.unsubscribe(h.updateThumbView,this.updateTipView),this};function I({min:t,max:e,value:s,decimalPlaces:a,step:l,isRange:r,direction:h,hasFill:n,hasTips:c,hasScale:d,isDecimal:u,panel:o}){const m=null!=t?t:i.min,f=null!=e?e:i.max,p=null!=a?a:i.decimalPlaces,b=null!=l?l:i.step,w=null!=r?r:i.isRange,v=null!=h?h:i.direction,S=null!=n?n:i.hasFill,T=null!=c?c:i.hasTips,g=null!=d?d:i.hasScale,V=null!=u?u:i.isDecimal,O=null!=o?o:i.panel;let F=null!=s?s:i.value;return Array.isArray(F)||(F=[F]),r&&1===F.length&&F.push(F[0]),{min:m,max:f,value:F,decimalPlaces:p,step:b,isRange:w,direction:v,hasFill:S,hasTips:T,hasScale:g,isDecimal:V,panel:O}}$.fn.extend({slider:function(t){const e=this[0],i=I(t||{}),s=function(t,e){let i;return i=t.data(c.datafirstValue)&&t.data(c.dataSecondValue)?[Number(t.data(c.datafirstValue)),Number(t.data(c.dataSecondValue))]:Number(t.data(c.datafirstValue))||Number(t.data(c.dataSecondValue))?[Number(t.data(c.datafirstValue))]||0:e.value,{min:Number(t.data(c.min))||e.min,max:Number(t.data(c.max))||e.max,value:i,decimalPlaces:Number(t.data(c.decimalPlaces))||e.decimalPlaces,step:Number(t.data(c.step))||e.step,isRange:Boolean(t.data(c.isRange))||e.isRange,direction:t.data(c.direction)||e.direction,hasFill:Boolean(t.data(c.hasFill))||e.hasFill,hasTips:Boolean(t.data(c.hasTips))||e.hasTips,hasScale:Boolean(t.data(c.hasScale))||e.hasScale,isDecimal:Boolean(t.data(c.isDecimal))||e.isDecimal}}($(e),i);return new class{constructor(t,e){this.params=e,this.DOMroot=t,this.DOMparent=t.parentElement,this.presenter=new class{constructor(t,e,i){this.DOMroot=e,this.DOMparent=i,this.model=new x(this.DOMroot),this.view=new _(this.DOMroot),this.params=t,this.clearHTML=y.bind(this),this.removeListeners=C.bind(this),this.subscribe=R.bind(this),this.unsubscribe=q.bind(this),this.updateThumbAfterTrackClick=j.bind(this),this.updateThumb=B.bind(this),this.updateFill=U.bind(this),this.updateThumbView=H.bind(this),this.updateTipView=E.bind(this),this.updateFillView=A.bind(this),this.addListeners=N.bind(this)}init(){this.setParams(this.params),this.createSlider(),this.subscribe(),this.addListeners()}rerender(t){this.setParams(t),this.view.thumbView.thumbs=[],this.view.tipView.tips=[],this.unsubscribe(),this.clearHTML(),this.removeListeners(),this.createSlider(),this.subscribe(),this.addListeners()}setParams(t){this.params=t}getParams(){return this.params}createSlider(){this.addSliderClasses(this.params.direction).setModelState().setViewState().setSubViewsState().renderSlider()}setModelState(){this.model.setParams(this.params);const t=this.model.getParams().direction===n.horizontal?this.DOMroot.offsetWidth:this.DOMroot.offsetHeight;return this.model.setSize(t),this.model.getParams().value.forEach(((t,e)=>{this.model.setOffset(e,this.model.calculateOffset(e))})),this.model.setFillState(this.model.calculateFillState()),this}addSliderClasses(t){return this.DOMroot.classList.add("slider"),this.DOMroot.classList.add("js-slider"),this.DOMroot.classList.add(`slider_${t}`),this.DOMroot.classList.add(`js-slider_${t}`),this.DOMparent.classList.add(`slider-parent_${t}`),this}setViewState(){return this.view.setParams(this.model.getParams()),this.view.setSize(this.model.getSize()),this.view.prepareDirectionForInteraction(this.model.getParams().direction),this}setSubViewsState(){const{hasTips:t,hasFill:e}=this.model.getParams(),i=this.model.getValue(),s=this.model.getFillState();return i.forEach(((e,i)=>{this.setThumbViewState(i),t&&this.setTipViewState(i)})),e&&this.setFillViewState(s),this}setThumbViewState(t){const e=this.model.getOffset()[t];this.view.thumbView.setOffset(t,e)}setFillViewState(t){this.view.fillView.setState(t)}setTipViewState(t){const e=this.model.getOffset()[t];this.view.tipView.setOffset(t,e)}renderSlider(){const{direction:t,hasFill:e,hasScale:i,hasTips:s,isRange:a}=this.model.getParams();this.renderTrack(t),this.renderThumb(0),s&&this.renderTip(0,t),i&&this.renderScale(t),e&&this.renderFill(t),a&&(this.renderThumb(1),s&&this.renderTip(1,t))}renderTrack(t){this.view.trackView.renderTrack(t)}renderThumb(t){this.view.thumbView.renderThumb(t)}renderTip(t,e){this.view.tipView.renderTip(t,e)}renderFill(t){this.view.fillView.renderFill(t)}renderScale(t){const{step:e,max:i,min:s}=this.model.getParams();this.view.scaleView.renderScale(t),this.view.scaleView.renderScaleMarks(e,i,s,t)}}(this.params,this.DOMroot,this.DOMparent),this.init()}getParams(){return this.params}getContainer(){return this.DOMroot}getParent(){return this.DOMparent}unsubscribe(){this.presenter.unsubscribe()}updateParams(t){this.presenter.rerender(I(t)),this.params=this.presenter.model.getParams()}subscribe(t){this.presenter.model.subscribe(h.updateThumbView,t)}init(){this.presenter.init(),this.attachResizeListener()}attachResizeListener(){window.addEventListener("resize",(()=>this.presenter.rerender(this.params)))}}(e,s)}}),document.querySelectorAll('[data-slider="true"]').forEach((t=>{$(t).slider()}))})();